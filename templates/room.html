{% extends "base.html" %}

{% block title %}–°–æ–≤–º–µ—Å—Ç–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä{% endblock %}

{% block head %}
<style>
    .room-header {
        margin-bottom: 30px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 20px;
    }
    .video-container {
        position: relative;
        width: 100%;
        background: #000;
        border-radius: 16px;
        overflow: hidden;
        aspect-ratio: 16/9;
        box-shadow: 0 20px 50px rgba(0,0,0,0.5);
        margin-bottom: 30px;
    }
    video {
        width: 100%;
        height: 100%;
    }
    .room-controls {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin-bottom: 40px;
    }
    .control-group {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
    }
    .quality-badge {
        display: inline-block;
        padding: 4px 12px;
        border-radius: 20px;
        background: var(--primary-glow);
        color: var(--primary-color);
        font-size: 0.8rem;
        font-weight: 600;
        margin-bottom: 15px;
    }
</style>
{% endblock %}

{% block content %}
<div class="fade-in">
    <div class="room-header">
        <div>
            <h1 style="margin: 0;">–°–µ—Ä–∏—è {{ seria }} <span style="color: var(--text-muted); font-size: 1.2rem;">(–ö–æ–º–Ω–∞—Ç–∞)</span></h1>
            <a href="https://kodikdb.com/find-player?{{ id_type }}ID={{ id }}&only_season=false" class="nav-link" style="font-size: 0.9rem;">‚Üó –°–º–æ—Ç—Ä–µ—Ç—å –≤ Kodik</a>
        </div>
        <div style="display: flex; gap: 10px;">
            <a href="/"><button class="btn-modern">üè† –ì–ª–∞–≤–Ω–∞—è</button></a>
            <button class="btn-modern btn-secondary copy_link">üîó –°—Å—ã–ª–∫–∞ –Ω–∞ –∫–æ–º–Ω–∞—Ç—É</button>
            <button class="btn-modern btn-secondary create_qr">üì± QR –ö–æ–¥</button>
        </div>
    </div>

    <div class="video-container">
        <video controls autoplay id="vid">
            <source src="{{ straight_url }}#t={{ start_time }}" type="video/mp4">
        </video>
    </div>

    <div class="room-controls">
        <div class="glass-card" style="padding: 20px;">
            <h3 style="margin-bottom: 15px; font-size: 1rem; color: var(--text-muted);">–ù–∞–≤–∏–≥–∞—Ü–∏—è</h3>
            <div class="control-group">
                {% if seria > 1 %}
                <a href="cs-{{ seria-1 }}/"><button class="btn-modern btn-secondary">‚Üê –ü—Ä–µ–¥. —Å–µ—Ä–∏—è</button></a>
                {% endif %}
                {% if seria < series %}
                <a href="cs-{{ seria+1 }}/"><button class="btn-modern">–°–ª–µ–¥. —Å–µ—Ä–∏—è ‚Üí</button></a>
                {% endif %}
            </div>
            
            {% if seria > 0 %}
            <form method="POST" style="margin-top: 20px;">
                <div style="display: flex; gap: 10px;">
                    <input id="choose_seria_num" name="seria" placeholder="‚Ññ —Å–µ—Ä–∏–∏" required class="search-input-modern" style="width: 120px; padding: 8px 15px;">
                    <button type="submit" class="btn-modern" style="padding: 8px 20px;">–ü–µ—Ä–µ–π—Ç–∏</button>
                </div>
            </form>
            {% endif %}
        </div>

        <div class="glass-card" style="padding: 20px;">
            <h3 style="margin-bottom: 15px; font-size: 1rem; color: var(--text-muted);">–ö–∞—á–µ—Å—Ç–≤–æ –∏ –ø–µ—Ä–µ–º–æ—Ç–∫–∞</h3>
            <div class="quality-badge">–¢–µ–∫—É—â–µ–µ: {{ quality }}p</div>
            <div class="control-group" style="margin-bottom: 15px;">
                <a href="cq-720/" class="btn-modern btn-secondary" style="padding: 6px 12px; font-size: 0.8rem;">720p</a>
                <a href="cq-480/" class="btn-modern btn-secondary" style="padding: 6px 12px; font-size: 0.8rem;">480p</a>
                <a href="cq-360/" class="btn-modern btn-secondary" style="padding: 6px 12px; font-size: 0.8rem;">360p</a>
            </div>
            <div class="control-group">
                <button onclick="skip_left();" class="btn-modern btn-secondary" style="padding: 8px 15px; font-size: 0.85rem;">- 1:20</button>
                <button onclick="skip_right();" class="btn-modern btn-secondary" style="padding: 8px 15px; font-size: 0.85rem;">+ 1:20</button>
            </div>
        </div>
    </div>

    <div id="qr_code_container" style="display: none; justify-content: center; margin-bottom: 30px;">
        <div class="glass-card" style="padding: 20px; text-align: center;">
            <div id="qr_code" style="background: white; padding: 10px; border-radius: 8px; display: inline-block;"></div>
            <p style="margin-top: 10px; font-size: 0.8rem; color: var(--text-muted);">–°–∫–∞–Ω–∏—Ä—É–π—Ç–µ –¥–ª—è –≤—Ö–æ–¥–∞ —Å –¥—Ä—É–≥–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞</p>
        </div>
    </div>

    <div class="glass-card" style="padding: 20px; color: var(--text-muted); font-size: 0.9rem;">
        <h4 style="color: var(--text-main); margin-bottom: 10px;">–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?</h4>
        <p>‚Ä¢ –í–∏–¥–µ–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è —É –≤—Å–µ—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤. –ü–∞—É–∑–∞ –∏–ª–∏ –ø–µ—Ä–µ–º–æ—Ç–∫–∞ —É –æ–¥–Ω–æ–≥–æ –ø—Ä–∏–º–µ–Ω–∏—Ç—Å—è –∫–æ –≤—Å–µ–º.</p>
        <p>‚Ä¢ –ï—Å–ª–∏ –ø–ª–µ–µ—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω –∏–ª–∏ –≤—ã–¥–∞–µ—Ç –æ—à–∏–±–∫—É, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–º–µ–Ω–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–æ.</p>
        <p>‚Ä¢ –î–ª—è —Ä—É—á–Ω–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ—Å—Ç–æ –ø–æ—Å—Ç–∞–≤—å—Ç–µ –≤–∏–¥–µ–æ –Ω–∞ –ø–∞—É–∑—É –∏ —Å–Ω–æ–≤–∞ –≤–∫–ª—é—á–∏—Ç–µ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ.</p>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js" integrity="sha512-q/dWJ3kcmjBLU4Qc47E4A9kTB4m3wuTY7vkFJDTZKjTs8jhyGQnaUrxa0Ytd0ssMZhbNua9hE+E7Qv1j+DyZwA==" crossorigin="anonymous"></script>
<script src="{{ url_for('static', filename='js/room_funcs.js') }}"></script>
<script>
    // –ü–æ–∫–∞–∑ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ QR –∫–æ–¥–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏
    document.querySelector('.create_qr').addEventListener('click', () => {
        document.getElementById('qr_code_container').style.display = 'flex';
    });
</script>
{% endblock %}